# 算子

## 1. 分类

算子会对属性做处理，按照其作用域，算子能够分为三种：

- col:作用于特定的属性: 如清除特定属性的空白符 
- data:作用于整个字典： 例如清除所有以a开头的属性
- stream:作用于数据流： 只获取数据流的前三个数据，或跳过2个数据。

## 2. 功能表

下面的表，整理了算子的使用方法：

| 名称 | 参数 | 功能 | 执行后结果 |  例子   | 类型 |
| -------- | ------ | -------- | ------ |-------- | ------ |
|   |    |     | 设定目标列   |  |   | 
| let | 'new' | 设置目标列为new |  new | let('new') |TF-data |
| mv | 'old:new' | 从原始列移动到新列 |  new | mv('a:b') |TF-data |
| cp | 'old:new' | 从原始列复制到新列 |  new | cp('a:b') |TF-data |
| cp2 | 'old:new' | 从原始列复制到新列 | old | cp('a:b') |TF-data |
| rm | 'a' | 删除a列 | 不变 | rm('a b') | TF-data |
| keep | 'a'  | 保留a列 | a | keep('a') |TF-data| 
|   |    |     | 转换器   |  |   | 
| incr | 无 | 增加自增主键 | 不变 | incr() |TF-col |
| split | 分隔符 | 对目标列分割 | [] | split(',') |TF-col |
| into | 'a b' | 将数组分配到不同列 |  无 | into('a b')  | TF-data|
| at |  索引 | 提取数组/字典的项 | 无 |at('a') |  TF-data|
| escape | html/url | 进行html/url转义 | str | escape('html') | TF-col|
| clean | html/url | 进行html/url反转义 | str | clean('url') |TF-col|
| format | 合并表达式 | 合并多个列 | str | format('{0}-{col}') |  TF-col|
| regex | 正则表达式 |  获取节点的text或str | regex('\d+') | [str] |   TF-col|
| replace | 正则表达式 | 替换匹配的值 | replace('\d+',value='new') | str|   TF-col|
| num | 无 | 提取数字 | num() | [float] |   TF-col|
| strip | char | 清除首尾符号 | strip() | str |   TF-col|
| extract| 起始字符串 | 首尾夹逼提取 | extract('start',end='end') | str |   TF-col|
| map| func/lambda | 对每个元素操作 | map(print)  | ? |   TF-col/data|
| dump| 'json/yaml/xml'  | 将目标列导出 | dump('json')  | str |   TF-col|
| load| 'json/yaml/xml'  | 从文本导入 | load('json')  | obj |   TF-col|
| todict| 'a b'  | 将a,b列合并到字典 | todict('a b')  | obj |   TF-data|
| drill| 'a:b'  | 将目标列字典提到外部 | drill('a:b')  | 无 |   TF-data|
|   |    |     | 爬虫工具   |  |   | 
| html |  无 | 获取节点的html | html() |str|  TF-col|
| text |  无 | 获取节点的text或str | text() |str|  TF-col|
| xpath | xpath-str | 通过xpath提取html | [node] | xpath('//div') | TF-col|
| pyq | jquery-str | 通过jquery提取html | [node] | pyq('.a')| TF-col|
| detect | int | 自动嗅探网页列表 | 表格+xpath | detect(0)| TF-data|
| cache | 空数组 | 缓存之前结果 | 无 | cache([])| TF-data|
| get | 发送的数据 | http-get请求 | 无 |get('[p]')| TF-col|
| post | 发送的数据 | http-post请求 | 无 |post('[p]')| TF-col|
| tree | html | 对html建立etree | 无 | tree() |  TF-col|
| search | 关键字 | 对html搜索xpath | 打印xpath | search('aa') |  TF-col|
| dl | 目标路径 | 将目标列链接下载到某路径 | 无 | dl('abc.zip') |  TF-col|
|   |    |     | 流处理   |  |   | 
| take | 数量p | 获取前p个元素 | 无 | take(5) |TF-stream |
| list | 要提取的列 | 将某列数组数据上钻 | 新列表 | list('a b c') |TF-stream |
| skip | 数量p | 跳过前p个元素 | 无 | skip(5) |TF-stream |
| last | 无参数 | 获取最后的元素 | 无 | last() |TF-stream |
| count | 数量p | 每p个元素打印index | 不变 | count(5) |TF-stream |
| tag | 注释 | 仅需注释 | 不变 | tag('注释') |TF-stream |
| agg | 函数/lambda | 对相邻数据聚合 | 不变 | agg(lambda a,b: a+b) |TF-stream |
| delay | 数量p | 延迟p毫秒 | 不变 | delay(100) |TF-stream |
| pl | 并行模式 | 插入并行算子 | 无 | pl(5) |TF-stream |
|   |    |     | 生成器   |  |   | 
| create | 生成器/数组 | 生成数据 | 不变 | create([{}]) |GE-data/col|
| range | 区间表达式字符串 | 生成固定区间数 | 不变 | range('1:100:2') |GE-col |
| read | 文件路径 | 按文件行读取 | 不变 | read('a.txt') |GE-col |
|   |    |     | 过滤器   |  |   | 
| where | 函数/lambda | 对数据做过滤 | 不变 | where(lambda x:x!=None) | FT-col|
| null | 无参数 | 过滤空对象 | 不变 | null() | FT-col|
| repeat | 无参数 | 过滤重复数据 | 不变 | repeat() | FT-col|
| match | 正则 | 过滤非匹配数据 | 不变 | match('\d') | FT-col|
|   |    |     | 执行器   |  |   | 
| dbex | 连接器名称 | 将数据写入连接器 | 不变 | dbex('connector') |EX-data |
| write | 文件路径 | 将数据按行写入文件 | 不变 | write('abc.txt') |EX-col |
|   |    |     | 排序器   |  |   | 
| ascend | 函数/lambda | 升序排列 | 不变 | ascend(lambda x:x[0]) |ST-data |
| descend | 函数/lambda | 降序排列 | 不变 | 同上 |ST-col |
|   |    |     | 子任务   |  |   | 
| subge | 子任务名称或实例 | 以生成器方式调用| 不变 | subge(task().create()..) |GE-stream |
| subex | 子任务名称或实例 | 以执行器方式调用| 不变 | subex('task_name') | EX-stream |
| sub | 子任务名称或实例 | 以转换器方式调用| 不变 | sub('task_name') | TF-stream |



