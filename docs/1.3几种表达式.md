
# 几种表达式

## 方括号


算子的参数可以从其他列读取，使用方括号，可以从当前的字典读取其他列的值，作为算子参数。

```
task().create(datas).p.set(',').a.split('[p]')   #等价于上面的值，方括号表达式指代从p列读取
```

> 目前还不支持嵌套表达，不支持类似`[p][p2]`
> 方括号可以用于任意算子的主要参数。
> 最常见的是生成区间数。
> 方括号语法还能使用在参数系统param中。 


## 范围

表示一个范围，例如下面的例子:

- `1` 只表示1
- `1:10` 1到10之间的正整数
- `1:10:2` 1,3,5,..9
- `[p]:[q]:[m]` 如`1:10:2`，但值是从其他列读取的。

范围表达式可用于create,range,notin等算子中。

## 格式化

用于format算子，使用方法和python标准的format用法一致。请参考相关文档

## 列转换

用于mv,cp,cp2,keep,let等算子， 有下面几种情况：

- p   p列
- `p q r` pqr三个列，用空格分割
- `_ q r` 其中`_`代表上一个算子的目标列
- `p:q r i:j`  p列转换到q列，r不变，i转换到j列。
- `[p] q r`  第一个列名要从p列读取

如果想让后面的算子针对整个字典，有两种办法：

- `...let('')` 传入空参数
- `...html()._...` 

其中用attr表示的`_`等价于let('_')

> 可以参考map,where和sort的用法

## 函数表达式

在map和where算子中，可以传入字符串的函数作为参数。假设数据是字典`{'p':10,'q':30}`

分两种情况:

- 作用在目标列（该列的数据用_表示）

`p.map('_>5')`

- 作用在整个数据 (该字典用_表示，每个属性可以直接访问，如p,q)

`_.map('p>5 and q<3')`

但不是所有的列名都是合法的python变量，例如`p['12']`,因此还可以通过索引器来访问，上面的代码等价于:

`_.map("_['p']>5 and _['q']<3")`


> _表示上一个算子的目标列/数据




